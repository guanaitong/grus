<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Create a static site from a set of Markdown files to host the documentation of Java"><meta name=author content="August Zhou"><link href=https://java.guide.wuxingdev.cn/grus/redis/ rel=canonical><link rel=icon href=../../assets/favicon.ico><meta name=generator content="mkdocs-1.2.3, mkdocs-material-7.3.6"><title>redis 模块 - Java Guide</title><link rel=stylesheet href=../../assets/stylesheets/main.a57b2b03.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.3f5d1f46.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#redis class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Java Guide" class="md-header__button md-logo" aria-label="Java Guide" data-md-component=logo> <img src=../../assets/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Java Guide </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> redis 模块 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://gitlab.wuxingdev.cn/java/framework/grus title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> java/framework/grus </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> 首页 </a> </li> <li class=md-tabs__item> <a href=../../prepare/contribute/manage/ class=md-tabs__link> 序言 </a> </li> <li class=md-tabs__item> <a href=../introduction/origin/ class="md-tabs__link md-tabs__link--active"> grus框架 </a> </li> <li class=md-tabs__item> <a href=../../others/develop-guide/ class=md-tabs__link> 其他 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Java Guide" class="md-nav__button md-logo" aria-label="Java Guide" data-md-component=logo> <img src=../../assets/logo.png alt=logo> </a> Java Guide </label> <div class=md-nav__source> <a href=https://gitlab.wuxingdev.cn/java/framework/grus title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> java/framework/grus </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <div class="md-nav__link md-nav__link--index "> <a href=../..>首页</a> </div> <nav class=md-nav aria-label=首页 data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> 首页 </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> 序言 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=序言 data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 序言 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../prepare/contribute/manage/ class=md-nav__link> 开发管理 </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2 type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2> 环境安装 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=环境安装 data-md-level=2> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> 环境安装 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../prepare/develop-env/java-install/ class=md-nav__link> Java安装 </a> </li> <li class=md-nav__item> <a href=../../prepare/develop-env/maven-install/ class=md-nav__link> Maven安装 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3 type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3> 规范 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=规范 data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 规范 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../prepare/specs/maven/ class=md-nav__link> Maven规范 </a> </li> <li class=md-nav__item> <a href=../../prepare/specs/app-framework-spec/ class=md-nav__link> 项目规范 </a> </li> <li class=md-nav__item> <a href=../../prepare/specs/jdbc-pool-config/ class=md-nav__link> 连接池规范 </a> </li> <li class=md-nav__item> <a href=../../prepare/specs/app-log/ class=md-nav__link> 日志规范 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_4 type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4> 技巧 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=技巧 data-md-level=2> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> 技巧 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../prepare/skill/LearningIdea/ class=md-nav__link> IDEA使用技巧 </a> </li> <li class=md-nav__item> <a href=../../prepare/skill/sonar/ class=md-nav__link> Sonarlint配置指南 </a> </li> <li class=md-nav__item> <a href=../../prepare/skill/checkstyle/ class=md-nav__link> Checksyle配置 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> grus框架 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=grus框架 data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> grus框架 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../introduction/origin/ class=md-nav__link> 简介 </a> </li> <li class=md-nav__item> <a href=../introduction/project-structure/ class=md-nav__link> 项目结构 </a> </li> <li class=md-nav__item> <a href=../introduction/project-starter/ class=md-nav__link> Starter模块 </a> </li> <li class=md-nav__item> <a href=../introduction/autoconfigure/ class=md-nav__link> Autoconfigure模块 </a> </li> <li class=md-nav__item> <a href=../introduction/condition/ class=md-nav__link> Condition条件注解 </a> </li> <li class=md-nav__item> <a href=../introduction/config/ class=md-nav__link> 配置文件 </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_7 type=checkbox id=__nav_3_7> <div class="md-nav__link md-nav__link--index "> <a href=../gconf/ >Gconf</a> </div> <nav class=md-nav aria-label=Gconf data-md-level=2> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Gconf </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_8 type=checkbox id=__nav_3_8> <div class="md-nav__link md-nav__link--index "> <a href=../api/ >巨灵神规范</a> <label for=__nav_3_8> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=巨灵神规范 data-md-level=2> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> 巨灵神规范 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../api/grus-feign-use/ class=md-nav__link> feign </a> </li> <li class=md-nav__item> <a href=../api/grus-feign-guide/ class=md-nav__link> 使用指南 </a> </li> <li class=md-nav__item> <a href=../api/grus-feign-best-practice/ class=md-nav__link> 最佳实践 </a> </li> <li class=md-nav__item> <a href=../api/grus-feign-contract/ class=md-nav__link> Feign协议升级 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_9 type=checkbox id=__nav_3_9> <div class="md-nav__link md-nav__link--index "> <a href=../data/ >data</a> <label for=__nav_3_9> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=data data-md-level=2> <label class=md-nav__title for=__nav_3_9> <span class="md-nav__icon md-icon"></span> data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../data/mybatis-pagehelper/ class=md-nav__link> Mybatis分页插件 </a> </li> <li class=md-nav__item> <a href=../data/mybatis-enhance/ class=md-nav__link> Mybatis增加 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_10 type=checkbox id=__nav_3_10 checked> <div class="md-nav__link md-nav__link--index md-nav__link--active"> <a href=./ >redis</a> </div> <nav class=md-nav aria-label=redis data-md-level=2> <label class=md-nav__title for=__nav_3_10> <span class="md-nav__icon md-icon"></span> redis </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_11 type=checkbox id=__nav_3_11> <div class="md-nav__link md-nav__link--index "> <a href=../zk/ >zookeeper</a> </div> <nav class=md-nav aria-label=zookeeper data-md-level=2> <label class=md-nav__title for=__nav_3_11> <span class="md-nav__icon md-icon"></span> zookeeper </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_12 type=checkbox id=__nav_3_12> <div class="md-nav__link md-nav__link--index "> <a href=../kafka/ >kafka</a> </div> <nav class=md-nav aria-label=kafka data-md-level=2> <label class=md-nav__title for=__nav_3_12> <span class="md-nav__icon md-icon"></span> kafka </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_13 type=checkbox id=__nav_3_13> <div class="md-nav__link md-nav__link--index "> <a href=../web/ >web</a> <label for=__nav_3_13> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=web data-md-level=2> <label class=md-nav__title for=__nav_3_13> <span class="md-nav__icon md-icon"></span> web </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../web/grus-validator/ class=md-nav__link> Validator模块 </a> </li> <li class=md-nav__item> <a href=../web/grus-swagger/ class=md-nav__link> Swagger使用说明 </a> </li> <li class=md-nav__item> <a href=../web/grus-freemarker/ class=md-nav__link> Freemarker使用说明 </a> </li> <li class=md-nav__item> <a href=../web/grus-velocity/ class=md-nav__link> Velocity使用说明 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_14 type=checkbox id=__nav_3_14> <div class="md-nav__link md-nav__link--index "> <a href=../job/ >job</a> <label for=__nav_3_14> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=job data-md-level=2> <label class=md-nav__title for=__nav_3_14> <span class="md-nav__icon md-icon"></span> job </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../job/elasticjob/ class=md-nav__link> ElasticJob介绍 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_15 type=checkbox id=__nav_3_15> <div class="md-nav__link md-nav__link--index "> <a href=../test/ >单元测试</a> </div> <nav class=md-nav aria-label=单元测试 data-md-level=2> <label class=md-nav__title for=__nav_3_15> <span class="md-nav__icon md-icon"></span> 单元测试 </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_16 type=checkbox id=__nav_3_16> <div class="md-nav__link md-nav__link--index "> <a href=../limit/ >微服务流量控制</a> </div> <nav class=md-nav aria-label=微服务流量控制 data-md-level=2> <label class=md-nav__title for=__nav_3_16> <span class="md-nav__icon md-icon"></span> 微服务流量控制 </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_17 type=checkbox id=__nav_3_17> <div class="md-nav__link md-nav__link--index "> <a href=../session/ >分布式session</a> </div> <nav class=md-nav aria-label=分布式session data-md-level=2> <label class=md-nav__title for=__nav_3_17> <span class="md-nav__icon md-icon"></span> 分布式session </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_18 type=checkbox id=__nav_3_18> <div class="md-nav__link md-nav__link--index "> <a href=../gfs/ >分布式存储gfs</a> <label for=__nav_3_18> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=分布式存储gfs data-md-level=2> <label class=md-nav__title for=__nav_3_18> <span class="md-nav__icon md-icon"></span> 分布式存储gfs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../gfs/gfs-sdk/ class=md-nav__link> gfs-client使用说明 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_19 type=checkbox id=__nav_3_19> <div class="md-nav__link md-nav__link--index "> <a href=../frigate/ >frigate消息</a> <label for=__nav_3_19> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=frigate消息 data-md-level=2> <label class=md-nav__title for=__nav_3_19> <span class="md-nav__icon md-icon"></span> frigate消息 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../frigate/grus-frigate-message-handle/ class=md-nav__link> gfs-client使用说明 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_20 type=checkbox id=__nav_3_20> <div class="md-nav__link md-nav__link--index "> <a href=../others/ >others</a> <label for=__nav_3_20> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=others data-md-level=2> <label class=md-nav__title for=__nav_3_20> <span class="md-nav__icon md-icon"></span> others </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../others/grus-core/ class=md-nav__link> bean复制工具 </a> </li> <li class=md-nav__item> <a href=../others/grus-json/ class=md-nav__link> JSON使用说明 </a> </li> <li class=md-nav__item> <a href=../others/grus-17/ class=md-nav__link> Java17升级指南 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> 其他 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=其他 data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> 其他 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../others/develop-guide/ class=md-nav__link> 应用开发指南 </a> </li> <li class=md-nav__item> <a href=../../others/security-base/ class=md-nav__link> 安全基础 </a> </li> <li class=md-nav__item> <a href=../../others/short-url/ class=md-nav__link> 短链接 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 规范说明 </a> </li> <li class=md-nav__item> <a href=#redis_1 class=md-nav__link> redis 统一配置 </a> <nav class=md-nav aria-label="redis 统一配置"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 使用方式 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 特别说明 </a> </li> <li class=md-nav__item> <a href=#redis_2 class=md-nav__link> 多个 redis </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#redistemplate-serializer class=md-nav__link> RedisTemplate 与 Serializer </a> <nav class=md-nav aria-label="RedisTemplate 与 Serializer"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 序列化方法 </a> </li> <li class=md-nav__item> <a href=#serializer class=md-nav__link> 默认 Serializer </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 自定义序列化 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#redis-spring-cache class=md-nav__link> redis spring cache </a> </li> <li class=md-nav__item> <a href=#session class=md-nav__link> session </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=redis>redis 模块<a class=headerlink href=#redis title="Permanent link">&para;</a></h1> <p>目前，针对 redis 模块，我们统一封装了 <code>grus-boot-starter-redis</code>，规范大家对 redis 的使用。</p> <blockquote> <p><code>grus-boot-starter-server-web</code>，<code>grus-boot-starter-server-service</code>等 starter 不再默认包含<code>grus-boot-starter-redis</code>，大家如果想使用 redis 相关功能，请导入如下依赖：</p> </blockquote> <div class=highlight><pre><span></span><code>    &lt;dependency&gt;
        &lt;artifactId&gt;grus-boot-starter-redis&lt;/artifactId&gt;
        &lt;groupId&gt;com.ciicgat.grus.boot&lt;/groupId&gt;
    &lt;/dependency&gt;
</code></pre></div> <p>此 starter 自动包含 spring-boot-starter-data-redis 依赖，使用时需**联系运维配置**应用对应的 <code>redis-config.json</code>。</p> <h2 id=_1>规范说明<a class=headerlink href=#_1 title="Permanent link">&para;</a></h2> <blockquote> <p>鉴于过去 redis 的配置都由开发手动配置，不利于后期的维护和管理，我们不建议在项目的配置文件中，再由开发手动配置，统一交由运维配置。</p> </blockquote> <p>我们移除了 <code>com.ciicgat.sdk.redis.RedisConfig</code> 类，避免大家项目中再有如下初始化 RedisExecutor 的方式，请使用 <code>grus-boot-starter-redis</code> 自动注入的 <code>redisExecutor</code> 替代。</p> <div class=highlight><pre><span></span><code>    @Bean
    public RedisExecutor redisExecutor(){
        ConfigCollection configCollection = RemoteConfigCollectionFactoryBuilder.getInstance().getConfigCollection(&quot;xxx&quot;);
        RedisConfig redisConfig = configCollection.getBean(&quot;redis.properties&quot;, RedisConfig.class);
        return redisConfig.newRedisExecutor();
    }
</code></pre></div> <p><strong>一定要注意</strong>：如果项目因 RedisConfig 缺失而报错，请及时按照下面的文档修改。</p> <h2 id=redis_1>redis 统一配置<a class=headerlink href=#redis_1 title="Permanent link">&para;</a></h2> <p>类似于数据库的 <code>datasource.json</code>，我们 redis 也有统一的 <code>redis-config.json</code>。它的**<a href=https://architect.guide.wuxingdev.cn/redis/redis-config.html>配置格式说明见此处</a>。**</p> <blockquote> <p>支持**redis 单机**和**sentinel**模式的，屏蔽了底层细节。只需要运维配置相应的配置文件即可。</p> </blockquote> <p>应用满足如下条件时：</p> <ul> <li>引入了 <code>grus-boot-starter-redis</code> 的 GAV；</li> <li>gconf 配置中存在 <code>redis-config.json</code>；</li> </ul> <p>那么会自动加载 <code>GrusRedisAutoConfiguration</code>。</p> <div class=highlight><pre><span></span><code><span class=nd>@Configuration</span><span class=p>(</span><span class=n>proxyBeanMethods</span> <span class=o>=</span> <span class=kc>false</span><span class=p>)</span>
<span class=nd>@ConditionalOnClass</span><span class=p>({</span><span class=n>RedisOperations</span><span class=p>.</span><span class=na>class</span><span class=p>,</span> <span class=n>RedisClient</span><span class=p>.</span><span class=na>class</span><span class=p>,</span> <span class=n>RedisSetting</span><span class=p>.</span><span class=na>class</span><span class=p>})</span>
<span class=nd>@AutoConfigureBefore</span><span class=p>(</span><span class=n>RedisAutoConfiguration</span><span class=p>.</span><span class=na>class</span><span class=p>)</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>GrusRedisAutoConfiguration</span> <span class=p>{</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>Logger</span> <span class=n>LOGGER</span> <span class=o>=</span> <span class=n>LoggerFactory</span><span class=p>.</span><span class=na>getLogger</span><span class=p>(</span><span class=n>GrusRedisAutoConfiguration</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>DEFAULT_REDIS_CONFIG_KEY</span> <span class=o>=</span> <span class=s>&quot;redis-config.json&quot;</span><span class=p>;</span>

    <span class=nd>@AppName</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>appName</span><span class=p>;</span>

    <span class=nd>@Bean</span><span class=p>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&quot;redisSetting&quot;</span><span class=p>)</span>
    <span class=nd>@ConditionalOnMissingBean</span><span class=p>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&quot;redisSetting&quot;</span><span class=p>)</span>
    <span class=kd>public</span> <span class=n>RedisSetting</span> <span class=nf>redisSetting</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>RemoteConfigCollectionFactoryBuilder</span><span class=p>.</span><span class=na>getInstance</span><span class=p>().</span><span class=na>getConfigCollection</span><span class=p>(</span><span class=n>appName</span><span class=p>).</span><span class=na>getBean</span><span class=p>(</span><span class=n>DEFAULT_REDIS_CONFIG_KEY</span><span class=p>,</span> <span class=n>RedisSetting</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=nd>@Bean</span>
    <span class=nd>@ConditionalOnBean</span><span class=p>(</span><span class=n>RedisSetting</span><span class=p>.</span><span class=na>class</span><span class=p>)</span>
    <span class=nd>@ConditionalOnClass</span><span class=p>(</span><span class=n>Jedis</span><span class=p>.</span><span class=na>class</span><span class=p>)</span>
    <span class=nd>@ConditionalOnMissingBean</span><span class=p>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&quot;redisExecutor&quot;</span><span class=p>)</span>
    <span class=kd>public</span> <span class=n>RedisExecutor</span> <span class=nf>redisExecutor</span><span class=p>(</span><span class=nd>@Qualifier</span><span class=p>(</span><span class=s>&quot;redisSetting&quot;</span><span class=p>)</span> <span class=n>RedisSetting</span> <span class=n>redisSetting</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>redisSetting</span><span class=p>.</span><span class=na>newRedisExecutor</span><span class=p>();</span>
    <span class=p>}</span>

    <span class=nd>@Bean</span>
    <span class=nd>@ConditionalOnBean</span><span class=p>(</span><span class=n>RedisSetting</span><span class=p>.</span><span class=na>class</span><span class=p>)</span>
    <span class=nd>@ConditionalOnClass</span><span class=p>({</span><span class=n>RedisOperations</span><span class=p>.</span><span class=na>class</span><span class=p>,</span> <span class=n>RedisConnectionFactory</span><span class=p>.</span><span class=na>class</span><span class=p>})</span>
    <span class=nd>@ConditionalOnMissingBean</span><span class=p>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&quot;redisConnectionFactory&quot;</span><span class=p>)</span>
    <span class=kd>public</span> <span class=n>RedisConnectionFactory</span> <span class=nf>redisConnectionFactory</span><span class=p>(</span><span class=nd>@Qualifier</span><span class=p>(</span><span class=s>&quot;redisSetting&quot;</span><span class=p>)</span> <span class=n>RedisSetting</span> <span class=n>redisSetting</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>SpringRedisConfCreator</span><span class=p>.</span><span class=na>newRedisConnectionFactory</span><span class=p>(</span><span class=n>redisSetting</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=cm>/**</span>
<span class=cm>     * 初始化自定义 redisService 时需要</span>
<span class=cm>     *</span>
<span class=cm>     * @param redisConnectionFactory redisConnectionFactory</span>
<span class=cm>     * @return StringRedisTemplate</span>
<span class=cm>     */</span>
    <span class=nd>@Bean</span>
    <span class=nd>@ConditionalOnMissingBean</span>
    <span class=nd>@ConditionalOnBean</span><span class=p>(</span><span class=n>RedisConnectionFactory</span><span class=p>.</span><span class=na>class</span><span class=p>)</span>
    <span class=kd>public</span> <span class=n>StringRedisTemplate</span> <span class=nf>stringRedisTemplate</span><span class=p>(</span><span class=n>RedisConnectionFactory</span> <span class=n>redisConnectionFactory</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>checkRedisConnection</span><span class=p>(</span><span class=n>redisConnectionFactory</span><span class=p>);</span>
        <span class=n>StringRedisTemplate</span> <span class=n>template</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringRedisTemplate</span><span class=p>();</span>
        <span class=n>template</span><span class=p>.</span><span class=na>setConnectionFactory</span><span class=p>(</span><span class=n>redisConnectionFactory</span><span class=p>);</span>
        <span class=k>return</span> <span class=n>template</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=nd>@Bean</span>
    <span class=nd>@ConditionalOnMissingBean</span>
    <span class=nd>@ConditionalOnBean</span><span class=p>(</span><span class=n>StringRedisTemplate</span><span class=p>.</span><span class=na>class</span><span class=p>)</span>
    <span class=kd>public</span> <span class=n>RedisService</span> <span class=nf>redisService</span><span class=p>(</span><span class=n>StringRedisTemplate</span> <span class=n>stringRedisTemplate</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=k>new</span> <span class=n>RedisService</span><span class=p>(</span><span class=n>stringRedisTemplate</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=cm>/**</span>
<span class=cm>     * 项目启动前，校验下 redis 连接是否成功，失败则项目启动失败</span>
<span class=cm>     *</span>
<span class=cm>     * @param redisConnectionFactory redisConnectionFactory</span>
<span class=cm>     */</span>
    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>checkRedisConnection</span><span class=p>(</span><span class=n>RedisConnectionFactory</span> <span class=n>redisConnectionFactory</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>RedisConnection</span> <span class=n>redisConnection</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=n>redisConnection</span> <span class=o>=</span> <span class=n>redisConnectionFactory</span><span class=p>.</span><span class=na>getConnection</span><span class=p>();</span>
            <span class=n>redisConnection</span><span class=p>.</span><span class=na>ping</span><span class=p>();</span>
            <span class=n>LOGGER</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&quot;GAT Redis connect is normal&quot;</span><span class=p>);</span>
        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>RuntimeException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>LOGGER</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&quot;GAT Redis connect error, please check redis-config.json in gconf or call operations&quot;</span><span class=p>,</span> <span class=n>e</span><span class=p>);</span>
            <span class=k>throw</span> <span class=n>e</span><span class=p>;</span>
        <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>redisConnection</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>redisConnection</span><span class=p>.</span><span class=na>close</span><span class=p>();</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>

<span class=p>}</span>
</code></pre></div> <p>一切都帮你自动加载好了，然后可以在项目直接注入使用 redis 相关的类。</p> <h3 id=_2>使用方式<a class=headerlink href=#_2 title="Permanent link">&para;</a></h3> <p>使用框架时，redis 常用操作类已经注入，如:</p> <ul> <li>StringRedisTemplate、RedisTemplate 等等（spring-data-redis 中的类，使用 lettuce）；</li> <li>RedisExecutor（原先我们常用的方式，使用 jedis）；</li> <li>RedisService（简单的封装，使用 lettuce）。</li> </ul> <p><strong>Demo：</strong></p> <div class=highlight><pre><span></span><code><span class=nd>@Slf4j</span>
<span class=nd>@RestController</span>
<span class=nd>@RequestMapping</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>TestController</span> <span class=p>{</span>

    <span class=nd>@Resource</span>
    <span class=kd>private</span> <span class=n>RedisExecutor</span> <span class=n>redisExecutor</span><span class=p>;</span>

    <span class=nd>@Resource</span>
    <span class=kd>private</span> <span class=n>RedisService</span> <span class=n>redisService</span><span class=p>;</span>

    <span class=nd>@Resource</span>
    <span class=kd>private</span> <span class=n>StringRedisTemplate</span> <span class=n>stringRedisTemplate</span><span class=p>;</span>

    <span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&quot;/foo&quot;</span><span class=p>)</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>foo</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>String</span> <span class=n>test</span> <span class=o>=</span> <span class=n>redisExecutor</span><span class=p>.</span><span class=na>execute</span><span class=p>(</span><span class=n>jedis</span> <span class=o>-&gt;</span> <span class=n>jedis</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&quot;test-1&quot;</span><span class=p>));</span>
        <span class=k>return</span> <span class=n>test</span><span class=p>;</span>
    <span class=p>}</span>

<span class=p>}</span>
</code></pre></div> <h3 id=_3>特别说明<a class=headerlink href=#_3 title="Permanent link">&para;</a></h3> <ul> <li> <p>引入了 <code>grus-boot-starter-redis</code>，如果不配置 <code>redis-config.json</code>，项目启动会报错；</p> </li> <li> <p>项目启动时会简单校验下 redis 的可用性，如果 redis 异常，项目启动会报错，请及时处理；</p> </li> <li> <p>因为我们使用了自己初始化的 <code>RedisConnectionFactory</code>，所以 spring 默认的配置（如下）一般不会生效。</p> </li> </ul> <div class=highlight><pre><span></span><code><span class=na>spring.redis.host</span><span class=o>=</span><span class=s>redis.servers.dev.ofc</span>
<span class=na>spring.redis.port</span><span class=o>=</span><span class=s>6379</span>
<span class=na>spring.redis.database</span><span class=o>=</span><span class=s>15</span>
<span class=na>spring.redis.lettuce.pool.max-active</span><span class=o>=</span><span class=s>30</span>
</code></pre></div> <h3 id=redis_2>多个 redis<a class=headerlink href=#redis_2 title="Permanent link">&para;</a></h3> <p>某些项目因为历史原因，链接了多个 redis。框架也支持使用，步骤如下：</p> <ol> <li> <p>联系运维配置多个 redis-config.json 文件，一般主要使用的是 redis-config.json，另外的叫 redis-config-xxx.json；</p> </li> <li> <p>链接主 redis 的使用方式不变，redisExecutor、stringRedisTemplate 之类的照常使用；</p> </li> <li> <p>链接第二个 redis 的方式，事例如下（推荐第二个 redis 只用 redisExecutor 使用，不要使用 stringRedisTemplate，理由见下文）：</p> </li> </ol> <div class=highlight><pre><span></span><code><span class=nd>@Configuration</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>RedisConfigure</span> <span class=p>{</span>

     <span class=cm>/**</span>
<span class=cm>      * 名字一定不能叫 redisSetting，与默认的区分</span>
<span class=cm>      */</span>
    <span class=nd>@Bean</span>
    <span class=kd>public</span> <span class=n>RedisSetting</span> <span class=nf>phpRedisSetting</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>RemoteConfigCollectionFactoryBuilder</span><span class=p>.</span><span class=na>getInstance</span><span class=p>().</span><span class=na>getConfigCollection</span><span class=p>(</span><span class=s>&quot;payment&quot;</span><span class=p>).</span><span class=na>getBean</span><span class=p>(</span><span class=s>&quot;redis-config-php.json&quot;</span><span class=p>,</span> <span class=n>RedisSetting</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
    <span class=p>}</span>

     <span class=cm>/**</span>
<span class=cm>      * 名字一定不能叫 redisExecutor，与默认的区分</span>
<span class=cm>      */</span>
    <span class=nd>@Bean</span>
    <span class=kd>public</span> <span class=n>RedisExecutor</span> <span class=nf>phpRedisExecutor</span><span class=p>(</span><span class=n>RedisSetting</span> <span class=n>phpRedisSetting</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>phpRedisSetting</span><span class=p>.</span><span class=na>newRedisExecutor</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <ol> <li>使用方式（一定要注明 <code>bean name</code>）</li> </ol> <div class=highlight><pre><span></span><code><span class=nd>@Slf4j</span>
<span class=nd>@RestController</span>
<span class=nd>@RequestMapping</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>TestController</span> <span class=p>{</span>

     <span class=cm>/**</span>
<span class=cm>      * 默认链接 redis-config.json 配置的 redis</span>
<span class=cm>      */</span>
    <span class=nd>@Resource</span>
    <span class=kd>private</span> <span class=n>RedisExecutor</span> <span class=n>redisExecutor</span><span class=p>;</span>

     <span class=cm>/**</span>
<span class=cm>      * 链接 redis-config-php.json 配置的 redis &lt;br/&gt;</span>
<span class=cm>      * 如果使用 @Autowire，请配合 @Qualifier 一起使用，例如：&lt;br/&gt;</span>
<span class=cm>      * @Autowire</span>
<span class=cm>      * @Qualifier(&quot;phpRedisExecutor&quot;)</span>
<span class=cm>      * private RedisExecutor phpRedisExecutor;</span>
<span class=cm>      */</span>
    <span class=nd>@Resource</span>
    <span class=kd>private</span> <span class=n>RedisExecutor</span> <span class=n>phpRedisExecutor</span><span class=p>;</span>

     <span class=cm>/**</span>
<span class=cm>      * 默认链接 redis-config.json 配置的 redis，不会链接 redis-config-php.json，请注意</span>
<span class=cm>      */</span>
    <span class=nd>@Resource</span>
    <span class=kd>private</span> <span class=n>StringRedisTemplate</span> <span class=n>stringRedisTemplate</span><span class=p>;</span>

    <span class=cm>/**</span>
<span class=cm>      * 默认链接 redis-config.json 配置的 redis，不会链接 redis-config-php.json，请注意</span>
<span class=cm>      */</span>
    <span class=nd>@Resource</span>
    <span class=kd>private</span> <span class=n>RedisService</span> <span class=n>RedisService</span><span class=p>;</span>

    <span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&quot;/foo&quot;</span><span class=p>)</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>foo</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>String</span> <span class=n>test</span> <span class=o>=</span> <span class=n>redisExecutor</span><span class=p>.</span><span class=na>execute</span><span class=p>(</span><span class=n>jedis</span> <span class=o>-&gt;</span> <span class=n>jedis</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&quot;test-1&quot;</span><span class=p>));</span>
        <span class=k>return</span> <span class=n>test</span><span class=p>;</span>
    <span class=p>}</span>

<span class=p>}</span>
</code></pre></div> <p><strong>备注：</strong></p> <blockquote> <p>redisExecutor 使用了自定义的 jedis 的连接池，底层的初始化并没有依赖 spring 的 redisConnectionFactory，只是最后将其交给了 spring 管理。所以按前文初始化即可使用。</p> <p>如果 stringRedisTemplate 或 redisService，也想支持第二个 redis，例如：phpRedisService，需要同时初始化多个 redisConnectionFactory，初始化多个 stringRedisTemplate，配置不同的 connection，初始化多个 redisService，配置不同的 stringRedisTemplate。整体**比较麻烦**。</p> <p>如果使用，请保证初始化正确，避免客户端连接错了 redis。</p> </blockquote> <h2 id=redistemplate-serializer>RedisTemplate 与 Serializer<a class=headerlink href=#redistemplate-serializer title="Permanent link">&para;</a></h2> <p>Springboot 与 redis 的交互是以二进制方式进行（byte[]）。为了支持 Java 中的数据类型，就要对操作的对象（key，value，hashKey，hashValue...）做序列化操作。</p> <blockquote> <p>redisTemplate 只为 key value hashKey hashValue 设置 serializer</p> </blockquote> <h3 id=_4>序列化方法<a class=headerlink href=#_4 title="Permanent link">&para;</a></h3> <p>Springboot 默认提供了几个序列化的方法：</p> <ul> <li>JdkSerializationRedisSerializer（默认）</li> <li>StringRedisSerializer</li> <li>Jackson2JsonRedisSerializer</li> <li>GenericJackson2JsonRedisSerializer</li> <li>......</li> </ul> <p>grus 针对一些大 key，value，额外提供了 <code>GzipRedisSerializer</code> 来使用，存储压缩过后的 key 和 value。</p> <h3 id=serializer>默认 Serializer<a class=headerlink href=#serializer title="Permanent link">&para;</a></h3> <p>RedisTemplate 默认使用 JdkSerializationRedisSerializer 来进行，支持任意类型。但是，有一些问题：</p> <ul> <li>这种默认的序列化方式会导致 redis 中保存的 key 和 value 可读性较差，出现一些不可读的 16 进制字符。例如：</li> </ul> <div class=highlight><pre><span></span><code>\xAC\xED\00\0x5t\x00
</code></pre></div> <ul> <li>对象需要实现 java 的序列化接口，并且对象最好设置 <code>serialVersionUID</code> 为指定值（一般为 1L），不然对象新增或者删除字段后，序列化会出问题。</li> </ul> <h3 id=_5>自定义序列化<a class=headerlink href=#_5 title="Permanent link">&para;</a></h3> <p>如果希望采用别的序列化方式，例如：<code>Jackson2JsonRedisSerializer</code>，在 Configuration 代码初始化 bean：</p> <div class=highlight><pre><span></span><code>    @Bean
    RedisTemplate redisTemplate(RedisConnectionFactory redisConnectionFactory) {
        RedisTemplate redisTemplate = new RedisTemplate();
        redisTemplate.setConnectionFactory(redisConnectionFactory);
        // 使用Jackson2JsonRedisSerialize 替换默认序列化(默认采用的是JDK序列化)
        Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer&lt;&gt;(Object.class);
        ObjectMapper objectMapper = new ObjectMapper();
        objectMapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);
        objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);
        objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
        objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);
        jackson2JsonRedisSerializer.setObjectMapper(objectMapper);

        redisTemplate.setKeySerializer(new StringRedisSerializer());
        redisTemplate.setHashKeySerializer(new StringRedisSerializer());
        redisTemplate.setValueSerializer(jackson2JsonRedisSerializer);
        redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer);
        return redisTemplate;
    }
</code></pre></div> <h2 id=redis-spring-cache>redis spring cache<a class=headerlink href=#redis-spring-cache title="Permanent link">&para;</a></h2> <p><strong>spring 默认实现</strong></p> <p>使用 <code>grus-boot-starter-redis</code>。</p> <p>只需要额外做以下配置即可：</p> <p><img alt=spring-cache-config src=../../assets/images/java/spring-cache-config.png></p> <p>cache 模块依赖<code>starter-data-redis</code>模块。实现大家可以看类<code>org.springframework.boot.autoconfigure.cache.RedisCacheConfiguration</code>和<code>org.springframework.data.redis.cache.RedisCacheManager</code>。</p> <p>另外，<strong>需要在启动类上加上<code>@EnableCaching</code>注解</strong></p> <p>使用 spring 默认实现，<strong>会存在一些问题</strong>：</p> <ul> <li>如果数据反序列化或者获取数据失败，会抛出异常返回，不存在 fallback。</li> <li>没有接入我们的数据源</li> </ul> <p><strong>grus 实现</strong></p> <p>针对默认实现的问题，我们有自己的一套改进实现：<code>com.ciicgat.sdk.springcache.RedisCacheManager</code>，对应的 autoconfig 为:<code>GrusRedisSpringCacheAutoConfiguration</code>。</p> <p><strong>grus 实现会在 redis 连接出现问题或者数据反序列化失败时，走原始的数据获取渠道（如降级为读 mysql 里的数据）</strong></p> <p>使用起来也很简单：</p> <div class=highlight><pre><span></span><code>    @Bean
    public RedisCacheConfig redisCacheConfig(RedisSetting redisSetting) {
        RedisCacheConfig redisCacheConfig = new RedisCacheConfig();
        redisCacheConfig.setPrefix(&quot;U_&quot;);
        redisCacheConfig.setSerializer(RedisSerializer.java());
        redisCacheConfig.setExpirePolicy(name -&gt; 0);
        redisCacheConfig.setRedisSetting(redisSetting);
        return redisCacheConfig;
    }
</code></pre></div> <p>注意：依然需要引入<code>spring-boot-starter-data-redis</code>包，依然需要在启动类上加上<code>@EnableCaching</code>注解</p> <p><strong>grus 二级缓存实现</strong></p> <p>二级缓存实现，第一级本地缓存，使用的是现在主流的高性能缓存库 <a href=https://github.com/ben-manes/caffeine/wiki>Caffeine</a>，<code>grus-core</code> 中默认依赖了 <code>caffeine</code>，基于 grus 框架开发的项目可以随意使用<code>caffeine</code>，也可以对比下 <code>guava cache</code>，使用过 <code>guava cache</code> 的很容易上手 <code>caffeine</code>，语法基本一样； 第二级还是 redis 缓存。</p> <p>二级缓存版本依赖<code>grus</code>版本<code>2021.1.0</code>。</p> <p>使用在原有<code>RedisCacheConfig</code>增加本地缓存配置：</p> <div class=highlight><pre><span></span><code>redisCacheConfig.getLocalCacheConfig().setEnable(true).setGlobalEvict(true);
</code></pre></div> <p><code>LocalCacheConfig</code>本地缓存配置详细说明：</p> <ul> <li><code>enable</code>：是否启用本地内存缓存，所有其他的配置生效的前提都是 enable=true；</li> <li><code>globalEvict</code>：是否启用其全局删除机制（目前实现依赖于 redis 的 pub/sub 机制）；触发条件：使用注解<code>@CacheEvit</code>或者直接调用<code>RedisCache</code> or <code>L2Cache</code> 的 <code>evict()</code> 方法；</li> <li><code>channel</code>：globalEvict=true 时，用于订阅删除 key 的通道名，如果不填写，默认使用应用名；</li> <li><code>serialize</code>：是否序列化 value，如果为否，那么缓存的 value 为对象，如果是，那么缓存的 value 为对象序列化后的字节数组；不使用序列化性能更加高。但是需要保证返回的值，不能做修改。</li> <li><code>maximumSize</code>：本地缓存最大值，默认 102400。</li> </ul> <p>注意：本地内存还是尽量要过期，主要目的为了快速刷新缓存，所以本地缓存限制了最大缓存时间 <strong>3600s</strong>。默认本地缓存过期时间和<code>redis</code>一致（缓存时间&lt;= 3600s）。虽然本地缓存限制了最大缓存时间，也不用担心性能问题，<code>redis</code>缓存未失效的情况下，数据一直都会重新塞入本地缓存。</p> <p><strong>grus 缓存新升级</strong></p> <p>依赖<code>grus</code>版本 &gt; <code>2021.1.2</code>。</p> <p>新升级的缓存支持三种：<code>LocalCache</code>（本地缓存）、<code>RedisCache</code>（Redis 缓存）、<code>L2Cache</code>（二级缓存）；三种缓存可以同时使用，只需要构建对应的<code>CacheConfig</code>即可。</p> <div class=highlight><pre><span></span><code>    @Bean
    public RedisCacheConfig redisCacheConfig(RedisSetting redisSetting) {
        RedisCacheConfig redisCacheConfig = new RedisCacheConfig();
        redisCacheConfig.setRedisSetting(redisSetting);
        redisCacheConfig.setPrefix(&quot;GRUS_DEMO_3_&quot;);
        redisCacheConfig.setSerializer(RedisSerializer.java());
        redisCacheConfig.setUseGzip(true);
        redisCacheConfig.setCacheConfigFunc(name -&gt; {
            switch (name) {
                case &quot;useRedisCache&quot;:
                    return CacheConfig.redis().setExpireSeconds(600);
                case &quot;useLocalCacheSerialize&quot;:
                    return CacheConfig.localRedis().setExpireSeconds(600).setLocalExpireSeconds(120).setSerialize(true);
                case &quot;useLocalCache&quot;:
                    return CacheConfig.local().setExpireSeconds(60);
                case &quot;useLocalCacheNoExpire&quot;:
                    return CacheConfig.local().setExpireSeconds(0);
            }

            return CacheConfig.localRedis();
        });
        return redisCacheConfig;
    }
</code></pre></div> <p><strong>PS:</strong></p> <ul> <li>1、本地缓存支持长期有效，只需过期时间设置为 0；</li> <li>2、每个缓存的配置信息可以具体参见<code>CacheConfig</code>的<code>Local</code>、<code>Redis</code>、<code>LocalRedis</code>。</li> <li>3、三种缓存都是基于<code>redis</code>的<code>pub/sub</code>机制实现的分布式缓存，所以即使只使用本地缓存，也需要配置<code>redis</code>。</li> </ul> <h2 id=session>session<a class=headerlink href=#session title="Permanent link">&para;</a></h2> <ul> <li>大家使用<code>spring-session-data-redis</code></li> </ul> <div class=highlight><pre><span></span><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.session&lt;/groupId&gt;
    &lt;artifactId&gt;spring-session-data-redis&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre></div> <ul> <li> <p>此模块同样依赖<code>starter-data-redis</code>模块</p> </li> <li> <p>相关配置如下：</p> </li> </ul> <div class=highlight><pre><span></span><code>server.servlet.session.cookie.name=gsId
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.path=/
server.servlet.session.cookie.max-age=7200s

spring.session.store-type=redis
spring.session.timeout=1800s
spring.session.redis.namespace=grus-demo:session  //这个需要修改成各自应用的，区分开来
spring.session.redis.flush-mode=on_save
</code></pre></div> <ul> <li>后续会对<code>spring-session-data-redis</code>的初始化进一步分装</li> </ul> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../data/mybatis-enhance/ class="md-footer__link md-footer__link--prev" aria-label="上一页: Mybatis增加" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 上一页 </span> Mybatis增加 </div> </div> </a> <a href=../zk/ class="md-footer__link md-footer__link--next" aria-label="下一页: Zookeeper" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 下一页 </span> Zookeeper </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2016 - 2021 guanaitong </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", null], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.fcfe8b6d.min.js", "version": null}</script> <script src=../../assets/javascripts/bundle.b1047164.min.js></script> </body> </html>